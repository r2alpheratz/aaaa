<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="MenuMgn">



	<select id="selectMenuTreeList" resultType="map">
		SELECT MENU_SQ "id", MENU_NM "menuNm", MENU_LEVEL_NO "menuLevelNo", PARENT_MENU_SQ "parentMenuSq", MENU_SQ "value", MENU_URL "menuUrl", MENU_NM "superPrntNm"
		FROM TB_FR_MENU_INFO
		WHERE 1=1
		  <if test="useYn!=null and useYn!=''">
		  	AND USE_YN = #{useYn}
		  </if>
		  <if test="workgroupSq!=null and workgroupSq!=''">
		  	AND MENU_SQ NOT IN (SELECT MENU_SQ
		  						FROM TB_FR_MENU_AUTH_MAP
		  						WHERE WORKGROUP_SQ = #{workgroupSq})
		    AND MENU_URL != ''
		  </if>
		  ORDER BY MENU_LEVEL_NO ASC, MENU_ORDER_NO ASC , MENU_NM ASC
	</select>

	<select id="selectMenuInfoWithWorkgroup"  resultType="menuInfoVo">
			SELECT  A.MENU_SQ
		 		,A.PARENT_MENU_SQ
		 		,A.MENU_URL
		 		,A.MENU_LEVEL_NO
		 		,A.MENU_ORDER_NO

			<if test="language != null and language !='' ">
		    	, C.MESSAGE_VALUE as MENU_NM
		      </if>
		      <if test="language == null or language == '' ">
	             , A.MENU_NM
		      </if>
		FROM TB_FR_MENU_INFO A
		   <if test="language != null and language !='' ">
		,  TB_FR_MENU_MULTI_LANG_INFO C
		 </if>
	WHERE 	A.MENU_SQ IN (SELECT B.MENU_SQ
								  FROM   TB_FR_MENU_AUTH_MAP B
								  WHERE  B.WORKGROUP_SQ IN
								  	 <foreach item="workGroupSq" index="index" collection="workGroupSqs" open="(" separator="," close=")">
									    #{workGroupSq}
									  </foreach>
							 )
			AND 	A.USE_YN !='N'

				<if test="language != null and language !='' ">
				AND  A.MENU_SQ = C.MENU_SQ
				AND b.COUNTRY_CD = #{language}
			</if>
		  ORDER BY A.MENU_LEVEL_NO ASC, A.MENU_ORDER_NO ASC , A.MENU_NM ASC

		</select>

		<select id="selectMenuInfo" parameterType="menuInfoVo"	resultType="menuInfoVo">
			SELECT      a.MENU_SQ
		 		,a.PARENT_MENU_SQ
		 		,a.MENU_URL
		 		,a.MENU_LEVEL_NO
		 		,a.MENU_ORDER_NO
		 		   ,a.USE_YN
		 		<if test="language != null and language !='' ">
		    	, b.MESSAGE_VALUE as MENU_NM
		      </if>
		 		   <if test="language == null or language =='' ">
	             , a.MENU_NM
		      </if>
		  FROM TB_FR_MENU_INFO a
			<if test="language != null and language !='' ">
			, TB_FR_MENU_MULTI_LANG_INFO b
		     </if>

				WHERE 	1=1
				<if test="menuSq != null and menuSq !='' ">
			AND a.MENU_SQ = #{menuSq}
		</if>

			<if test="language != null and language !='' ">
			AND  a.MENU_SQ = b.MENU_SQ
		      </if>

				<if test="parentMenuSq != null ">
			AND a.PARENT_MENU_SQ = #{parentMenuSq}
		</if>
		<if test="menuLevelNo != null and menuLevelNo !=''">
			AND a.MENU_LEVEL_NO = #{menuLevelNo}
		</if>
			<if test="language != null and language !='' ">

				AND b.COUNTRY_CD = #{language}
			</if>
				<if test="menuUrl  != null">
            AND   a.MENU_URL  =  #{menuUrl}
          	</if>
		  ORDER BY a.MENU_LEVEL_NO ASC, a.MENU_ORDER_NO ASC , a.MENU_NM ASC

		</select>


        <update id="updateMenuInfo"  parameterType="menuInfoVo" >
    UPDATE TB_FR_MENU_INFO
         SET
         <if test="menuNm != null and menuNm !=''">
            	MENU_NM =  #{menuNm} ,
           </if>
          <if test="parentMenuSq  != null and parentMenuSq !=''">
               PARENT_MENU_SQ  =  #{parentMenuSq},
          	</if>
            <if test="menuUrl  != null">
              MENU_URL  =  #{menuUrl},
          	</if>
          	  <if test="menuLevelNo  != 0">
              MENU_LEVEL_NO  =  #{menuLevelNo},
          	</if>
	         <if test="menuOrderNo  != 0">
              MENU_ORDER_NO  =  #{menuOrderNo},
          	</if>
          	     <if test="useYn  != null and useYn !=''">
              USE_YN  =  #{useYn},
          	</if>
          	   UPDATE_USR_ID =  #{updateUsrId},
                UPDATE_DT =   NOW()
                WHERE MENU_SQ = #{menuSq}

</update>


<delete id="deleteMenuInfo"  parameterType="menuInfoVo">
  DELETE FROM TB_FR_MENU_INFO
 WHERE MENU_SQ = #{menuSq}

</delete>

	<select id="getMaxIdSeq" resultType="string">
		select MAX (substring(MENU_SQ from 5 for 10))  SEQ from TB_FR_MENU_INFO
	</select>



		<select id="selectMenuInfoOrderLevel" resultType="int">
		SELECT  MAX( MENU_ORDER_NO )+1 menuOrderNo
		FROM TB_FR_MENU_INFO
       WHERE PARENT_MENU_SQ = #{parentMenuSq}

	</select>


<insert id="insertMenuInfo"  parameterType="menuInfoVo">
   INSERT INTO TB_FR_MENU_INFO
    ( MENU_SQ, MENU_NM, PARENT_MENU_SQ, MENU_URL, MENU_LEVEL_NO,   MENU_ORDER_NO, USE_YN , CREATE_USR_ID, CREATE_DT)
VALUES (#{menuSq},  #{menuNm}, #{parentMenuSq},  #{menuUrl} , #{menuLevelNo},  #{menuOrderNo},  #{useYn},  #{createUsrId}, NOW() )
</insert>


<select id="selectMenuInfoByURL" parameterType="menuInfoVo"	resultType="menuInfoVo">
		SELECT      a.MENU_SQ
		 		,a.PARENT_MENU_SQ
		 		,a.MENU_URL
		 		,a.MENU_LEVEL_NO
		 		,a.MENU_ORDER_NO
		 	     ,a.USE_YN
		 		<if test="language != null and language !='' ">
		    	, b.MESSAGE_VALUE as MENU_NM
		      </if>
		 	 <if test="language == null or language =='' ">
	             , a.MENU_NM
		     	 </if>
				FROM TB_FR_MENU_INFO a
			<if test="language != null and language !='' ">
			, TB_FR_MENU_MULTI_LANG_INFO b
		     </if>
				WHERE 	1=1
			 <if test="menuSq != null and menuSq !='' ">
			AND a.MENU_SQ = #{menuSq}
			</if>
			<if test="language != null and language !='' ">
			AND  a.MENU_SQ = b.MENU_SQ
		      </if>
			<if test="language != null and language !='' ">
				AND b.COUNTRY_CD = #{language}
			</if>
			<if test="menuUrl  != null">
            AND   a.MENU_URL  =  #{menuUrl}
          	</if>
		  ORDER BY a.MENU_LEVEL_NO ASC, a.MENU_ORDER_NO ASC , a.MENU_NM ASC
		</select>
	<select id="selectMenuListForCombo" resultType="menuInfoVo">
		SELECT      a.MENU_SQ
		 		,a.PARENT_MENU_SQ
		 		,a.MENU_URL
		 		,a.MENU_LEVEL_NO
		 		,a.MENU_ORDER_NO
		 	     ,a.USE_YN
		 		<if test="language != null and language !='' ">
		    	, b.MESSAGE_VALUE as MENU_NM
		      </if>
		 	 <if test="language == null or language =='' ">
	             , a.MENU_NM
		     	 </if>
				FROM TB_FR_MENU_INFO a
			<if test="language != null and language !='' ">
			, TB_FR_MENU_MULTI_LANG_INFO b
		     </if>
				WHERE 	1=1
			 <if test="menuSq != null and menuSq !='' ">
			AND a.MENU_SQ = #{menuSq}
		</if>
			<if test="language != null and language !='' ">
			AND  a.MENU_SQ = b.MENU_SQ
		      </if>
				<if test="parentMenuSq != null ">
			AND a.PARENT_MENU_SQ = #{parentMenuSq}
		</if>
		<if test="menuLevelNo != null and menuLevelNo !=''">
			AND a.MENU_LEVEL_NO = #{menuLevelNo}
		</if>
			<if test="language != null and language !='' ">
				AND b.COUNTRY_CD = #{language}
			</if>
             AND   UPPER(a.MENU_URL) LIKE 'ADMIN/' || '%'
		  ORDER BY a.MENU_LEVEL_NO ASC, a.MENU_ORDER_NO ASC , a.MENU_NM ASC
	</select>
</mapper>