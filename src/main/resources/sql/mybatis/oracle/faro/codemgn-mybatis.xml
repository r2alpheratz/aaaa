<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="CodeMgn">

	<select id="selectCodeTreeList" resultType="codeInfoVo">
		SELECT CODE_SQ,CODE_SQ ID,
		CODE_NM, PARENT_CODE_SQ, INIT_YN
		FROM TB_FR_CODE_INFO
		ORDER BY CODE_ORDER_NO
	</select>

	<select id="selectCodeInfoList" parameterType="codeInfoVo"
	resultType="codeInfoVo">
		SELECT *
		FROM TB_FR_CODE_INFO
		WHERE 1=1
		<if test="parentCodeSq != null and parentCodeSq != ''">
			AND PARENT_CODE_SQ = #{parentCodeSq}
		</if>
			<if test="codeNm != null and codeNm != ''">
			AND UPPER(CODE_NM) LIKE '%'||UPPER(#{codeNm})||'%' ESCAPE '\'
		</if>
	</select>

	<select id="selectCodeInfo" parameterType="codeInfoVo"
	resultType="codeInfoVo">
			SELECT
		CODE_SQ,CODE_NM,PARENT_CODE_SQ,CODE_DESCRIPTION,CODE_LEVEL_NO,CREATE_DT,CREATE_USR_ID,UPDATE_DT,UPDATE_USR_ID,USE_YN,CODE_ORDER_NO, INIT_YN
		FROM TB_FR_CODE_INFO
		WHERE 1=1
		<if test="codeSq != null and codeSq != ''">
			AND CODE_SQ = #{codeSq}
		</if>
		<if test="parentCodeSq != null and parentCodeSq != ''">
			AND PARENT_CODE_SQ = #{parentCodeSq}
		</if>
		<if test="codeNm != null and codeNm != ''">
			AND CODE_NM = #{codeNm}
		</if>
			<if test="useYn != null and useYn != ''">
			AND USE_YN = #{useYn}
		</if>
	</select>

	<insert id="insertCodeInfo"  parameterType="codeInfoVo">
   		INSERT INTO TB_FR_CODE_INFO
    	( CODE_SQ, CODE_NM,  PARENT_CODE_SQ, CODE_DESCRIPTION,
    	 CODE_LEVEL_NO, CODE_ORDER_NO, CREATE_DT, CREATE_USR_ID , USE_YN)
		VALUES (#{codeSq},  #{codeNm},
		 #{parentCodeSq},  #{codeDescription, jdbcType=VARCHAR} ,  #{codeLevelNo},  #{codeOrderNo},
		    systimestamp,     #{createUsrId} ,   #{useYn})
	</insert>

	<update id="updateCodeInfo"  parameterType="codeInfoVo" >
    	UPDATE TB_FR_CODE_INFO
        SET
        <if test="codeNm != null and codeNm !=''">
        	CODE_NM =  #{codeNm} ,
        </if>
        <if test="parentCodeSq  != null and parentCodeSq !=''">
        	PARENT_CODE_SQ  =  #{parentCodeSq},
        </if>
        <if test="codeDescription  != null">
        	CODE_DESCRIPTION  =  #{codeDescription},
        </if>
        <if test="codeLevelNo  != 0">
        	CODE_LEVEL_NO  =  #{codeLevelNo},
        </if>
        <if test="codeOrderNo  != 0">
        	CODE_ORDER_NO  =  #{codeOrderNo},
        </if>
        <if test="useYn  != null and  useYn != ''">
        	USE_YN  =  #{useYn},
        </if>
        UPDATE_USR_ID =  #{updateUsrId},
        UPDATE_DT =   systimestamp
        WHERE CODE_SQ = #{codeSq}
	</update>

	<update id="updateCodeTreeList"  parameterType="map" >
    	UPDATE TB_FR_CODE_INFO
           SET CODE_ORDER_NO  =  #{codeOrderNo},
               PARENT_CODE_SQ = #{parentCodeSq},
			   CODE_LEVEL_NO =  #{codeLevelNo}
      	WHERE CODE_SQ = #{codeSq}
	</update>

	<select id="getMaxIdSeq" resultType="string">
		select  MAX(SUBSTR(CODE_SQ , 5 , 10)) AS   SEQ from TB_FR_CODE_INFO

	</select>

	<select id="getMaxOrderNo" parameterType="codeInfoVo" resultType="int">
		SELECT MAX(CODE_ORDER_NO) CODE_ORDER_NO
		FROM TB_FR_CODE_INFO
		WHERE PARENT_CODE_SQ = #{parentCodeSq}
	</select>

	<delete id="deleteCodeInfo"  parameterType="codeInfoVo">
		DELETE FROM TB_FR_CODE_INFO
		WHERE CODE_SQ = #{codeSq}
	</delete>

<select id="selectChildCode"  parameterType="codeInfoVo" resultType="codeInfoVo">

		SELECT  
			<choose>
				<when test="language != null and language !='' ">
		        	A.CODE_SQ, A.CODE_DESCRIPTION , B.MESSAGE_VALUE as CODE_NM
		     	</when>
         		<otherwise>
             		DISTINCT A.CODE_SQ, A.CODE_DESCRIPTION , A.CODE_NM, A.CODE_ORDER_NO
				</otherwise>
			</choose>
		FROM TB_FR_CODE_INFO A
		<if test="language != null and language !='' ">
		, TB_FR_CODE_MULTI_LANG_INFO B
		</if>
		WHERE 1=1
				AND A.PARENT_CODE_SQ = #{parentCodeSq}
				AND A.USE_YN = 'Y'
		<if test="language != null and language !='' ">
				AND B.COUNTRY_CD = #{language}
				AND A.CODE_SQ= B.CODE_SQ
		</if>		
		ORDER BY A.CODE_ORDER_NO


	</select>

	<select id="selectParentCode" parameterType="codeInfoVo" resultType="int">
		SELECT COUNT(*)
		FROM   TB_FR_CODE_INFO
		WHERE  PARENT_CODE_SQ = #{codeSq}
	</select>

	<select id="getEventCd" parameterType="hashmap" resultType="string">
		SELECT CODE_SQ
		FROM(
			SELECT A.CODE_SQ
			FROM TB_FR_CODE_INFO A, TB_FR_CODE_MULTI_LANG_INFO B
			WHERE A.CODE_SQ = B.CODE_SQ
			  AND UPPER(B.MESSAGE_VALUE) = UPPER(#{codeDescription})
			<if test="parentCodeSq != null and parentCodeSq !=''">
				AND A.PARENT_CODE_SQ = #{parentCodeSq}
			</if>

		)
		WHERE ROWNUM = 1
	</select>
	
	<select id="getDefaultLangCodeNm" parameterType="hashmap" resultType="string">
		SELECT A.CODE_NM
		  FROM TB_FR_CODE_INFO A
		 WHERE 1=1
		   AND A.CODE_SQ = #{codeSq}
	</select>
	
	<select id="getMultiLangCodeNm" parameterType="hashmap" resultType="string">
		SELECT A.MESSAGE_VALUE
		  FROM TB_FR_CODE_MULTI_LANG_INFO A
		 WHERE 1=1
		   AND A.CODE_SQ = #{codeSq}
		   AND A.COUNTRY_CD = #{countryCd}
	</select>
</mapper>
